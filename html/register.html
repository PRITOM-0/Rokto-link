<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blood Donation System - Register</title>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/register.css">
    <style>
        
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="navbar-content">
            <a href="../index.html" class="navbar-brand">Rokto-Link</a>
            <div class="navbar-links">
                <a href="../index.html" class="btn-home">Home</a>
                <a href="../html/login.html" class="btn-login">Login</a>
            </div>
        </div>
    </nav>

    <div class="register-container">
        <h2>Register for BloodLink</h2>

        <!-- Registration Form -->
        <form action="../php/register_user.php" method="POST" id="registerForm">
            <!-- User Account Details -->
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" name="username" placeholder="Choose a username" required>
                <p id="usernameError" class="error-message">Username is required and must be unique.</p>
            </div>

            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" placeholder="Enter your email address" required>
                <p id="emailError" class="error-message">Please enter a valid email address.</p>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" placeholder="Create a password" required>
                    <p id="passwordError" class="error-message">Password must be at least 6 characters long.</p>
                </div>
                <div class="form-group">
                    <label for="confirm_password">Confirm Password</label>
                    <input type="password" id="confirm_password" name="confirm_password" placeholder="Confirm your password" required>
                    <p id="confirmPasswordError" class="error-message">Passwords do not match.</p>
                </div>
            </div>

            <div class="form-group">
                <label for="user_type">Register as:</label>
                <select id="user_type" name="user_type" required>
                    <option value="">Select Role</option>
                    <option value="donor">Donor</option>
                    <option value="recipient">Recipient</option>
                </select>
                <p id="userTypeError" class="error-message">Please select a user type.</p>
            </div>

            <!-- Personal Details (Common for Donor/Recipient) -->
            <div class="form-group">
                <label for="full_name">Full Name</label>
                <input type="text" id="full_name" name="full_name" placeholder="Enter your full name" required>
                <p id="fullNameError" class="error-message">Full name is required.</p>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="date_of_birth">Date of Birth</label>
                    <input type="date" id="date_of_birth" name="date_of_birth" required>
                    <p id="dobError" class="error-message">Date of birth is required.</p>
                </div>
                <div class="form-group">
                    <label for="gender">Gender</label>
                    <select id="gender" name="gender" required>
                        <option value="">Select Gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                    <p id="genderError" class="error-message">Please select your gender.</p>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="blood_group">Blood Group</label>
                    <select id="blood_group" name="blood_group" required>
                        <option value="">Select Blood Group</option>
                        <option value="A+">A+</option>
                        <option value="A-">A-</option>
                        <option value="B+">B+</option>
                        <option value="B-">B-</option>
                        <option value="AB+">AB+</option>
                        <option value="AB-">AB-</option>
                        <option value="O+">O+</option>
                        <option value="O-">O-</option>
                    </select>
                    <p id="bloodGroupError" class="error-message">Blood group is required.</p>
                </div>
                <div class="form-group">
                    <label for="contact_number">Contact Number</label>
                    <input type="tel" id="contact_number" name="contact_number" placeholder="e.g., +1234567890" required>
                    <p id="contactNumberError" class="error-message">Please enter a valid contact number.</p>
                </div>
            </div>

            <div class="form-group">
                <label for="address">Address</label>
                <textarea id="address" name="address" rows="3" placeholder="Enter your full address" required></textarea>
                <p id="addressError" class="error-message">Address is required.</p>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="city">City</label>
                    <input type="text" id="city" name="city" placeholder="Enter your city" required>
                    <p id="cityError" class="error-message">City is required.</p>
                </div>
                <div class="form-group">
                    <label for="state">State/Province</label>
                    <input type="text" id="state" name="state" placeholder="Enter your state/province" required>
                    <p id="stateError" class="error-message">State/Province is required.</p>
                </div>
            </div>

            <!-- Recipient Specific Field (conditionally visible) -->
            <div id="medicalConditionGroup" class="form-group" style="display: none;">
                <label for="medical_condition">Medical Condition (for Recipients)</label>
                <textarea id="medical_condition" name="medical_condition" rows="3" placeholder="Describe any relevant medical conditions"></textarea>
            </div>

            <!-- Server-side error message placeholder -->
            <?php
                // This PHP block is a placeholder for displaying server-side errors.
                // In a real scenario, this page would be rendered by PHP after a failed registration attempt,
                // passing an error message via URL parameter or session.
                if (isset($_GET['error'])) {
                    echo '<p class="server-error">' . htmlspecialchars($_GET['error']) . '</p>';
                }
            ?>

            <button type="submit" class="register-button">Register</button>
        </form>

        <p class="login-link">
            Already have an account? <a href="../html/login.html">Login here</a>
        </p>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 BloodLink. All rights reserved.</p>
            <div class="footer-links">
                <a href="#">Privacy Policy</a>
                <a href="#">Terms of Service</a>
                <a href="#">Contact Us</a>
            </div>
        </div>
    </footer>

    <!-- Client-side validation script -->
    <script src="../js/validation.js"></script>
    <script>
        // Basic client-side validation for registration form
        document.addEventListener('DOMContentLoaded', function() {
            const registerForm = document.getElementById('registerForm');
            const userTypeSelect = document.getElementById('user_type');
            const medicalConditionGroup = document.getElementById('medicalConditionGroup');
            const medicalConditionInput = document.getElementById('medical_condition');

            // Function to toggle medical condition field visibility
            function toggleMedicalCondition() {
                if (userTypeSelect.value === 'recipient') {
                    medicalConditionGroup.style.display = 'block';
                    medicalConditionInput.required = true; // Make required for recipients
                } else {
                    medicalConditionGroup.style.display = 'none';
                    medicalConditionInput.required = false; // Not required for others
                    medicalConditionInput.value = ''; // Clear value if hidden
                }
            }

            // Initial call to set visibility based on default selection
            toggleMedicalCondition();

            // Add event listener for user type change
            userTypeSelect.addEventListener('change', toggleMedicalCondition);

            if (registerForm) {
                registerForm.addEventListener('submit', function(event) {
                    let isValid = true;

                    // Helper function to show/hide error messages
                    function validateField(inputElement, errorElement, validationFn) {
                        if (validationFn(inputElement.value.trim())) {
                            errorElement.style.display = 'none';
                        } else {
                            errorElement.style.display = 'block';
                            isValid = false;
                        }
                    }

                    // Validation functions
                    const isNotEmpty = value => value !== '';
                    const isValidEmail = value => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
                    const isMinLength = (value, min) => value.length >= min;
                    const doPasswordsMatch = (pass1, pass2) => pass1 === pass2;
                    const isValidDate = value => !isNaN(new Date(value)); // Simple date check

                    // Validate Username
                    validateField(document.getElementById('username'), document.getElementById('usernameError'), isNotEmpty);

                    // Validate Email
                    validateField(document.getElementById('email'), document.getElementById('emailError'), isValidEmail);

                    // Validate Password
                    const passwordInput = document.getElementById('password');
                    validateField(passwordInput, document.getElementById('passwordError'), value => isMinLength(value, 6));

                    // Validate Confirm Password
                    const confirmPasswordInput = document.getElementById('confirm_password');
                    const confirmPasswordError = document.getElementById('confirmPasswordError');
                    if (!isNotEmpty(confirmPasswordInput.value.trim()) || !doPasswordsMatch(passwordInput.value, confirmPasswordInput.value)) {
                        confirmPasswordError.style.display = 'block';
                        isValid = false;
                    } else {
                        confirmPasswordError.style.display = 'none';
                    }

                    // Validate User Type
                    validateField(userTypeSelect, document.getElementById('userTypeError'), isNotEmpty);

                    // Validate Full Name
                    validateField(document.getElementById('full_name'), document.getElementById('fullNameError'), isNotEmpty);

                    // Validate Date of Birth
                    validateField(document.getElementById('date_of_birth'), document.getElementById('dobError'), isValidDate);

                    // Validate Gender
                    validateField(document.getElementById('gender'), document.getElementById('genderError'), isNotEmpty);

                    // Validate Blood Group
                    validateField(document.getElementById('blood_group'), document.getElementById('bloodGroupError'), isNotEmpty);

                    // Validate Contact Number (simple check for non-empty)
                    validateField(document.getElementById('contact_number'), document.getElementById('contactNumberError'), isNotEmpty);

                    // Validate Address
                    validateField(document.getElementById('address'), document.getElementById('addressError'), isNotEmpty);

                    // Validate City
                    validateField(document.getElementById('city'), document.getElementById('cityError'), isNotEmpty);

                    // Validate State
                    validateField(document.getElementById('state'), document.getElementById('stateError'), isNotEmpty);

                    // Validate Medical Condition if Recipient
                    if (userTypeSelect.value === 'recipient') {
                        validateField(medicalConditionInput, document.getElementById('medicalConditionGroup').querySelector('.error-message') || document.createElement('p'), isNotEmpty);
                        // Note: The above line creates a dummy error message element if not found.
                        // For a real app, ensure a dedicated error span exists within medicalConditionGroup.
                        // For now, it will just prevent submission if empty.
                    }

                    if (!isValid) {
                        event.preventDefault(); // Prevent form submission if validation fails
                    }
                });
            }
        });
    </script>
</body>
</html>
